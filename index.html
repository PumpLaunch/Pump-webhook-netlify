<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CryptoFlux Base</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <style>
    body { background: #0f0f23; color: white; font-family: sans-serif; padding: 20px; }
    .btn { background: #9945ff; color: white; border: none; padding: 10px 20px; margin: 10px 0; border-radius: 8px; cursor: pointer; }
    .card { background: #1a1a3a; padding: 16px; border-radius: 12px; margin: 16px 0; }
  </style>
</head>
<body>
  <h2>CryptoFlux Pro — Base</h2>
  <button id="connectBtn" class="btn" disabled>Connecter Wallet</button>
  
  <div id="app" style="display:none;">
    <div class="card">
      <div><strong>Adresse :</strong> <span id="address">...</span></div>
      <div><strong>Solde :</strong> <span id="balance">0.00</span> SOL</div>
    </div>
  </div>

  <div id="status">Vérification du wallet...</div>

  <script>
    // ✅ RPC public officiel Solana (pas de clé API)
    const PUBLIC_RPC = 'https://api.mainnet-beta.solana.com';

    const statusEl = document.getElementById('status');
    const connectBtn = document.getElementById('connectBtn');
    const appEl = document.getElementById('app');
    const addressEl = document.getElementById('address');
    const balanceEl = document.getElementById('balance');

    function log(msg) {
      statusEl.textContent = msg;
      console.log(msg);
    }

    // Vérification immédiate
    if (window.phantom?.solana?.isPhantom) {
      log("✅ Wallet détecté !");
      connectBtn.disabled = false;
      connectBtn.onclick = async () => {
        try {
          log("Connexion en cours...");
          const provider = window.phantom.solana;
          const { publicKey } = await provider.connect();
          const pubKeyStr = publicKey.toString();

          // ✅ Utilise uniquement le RPC public
          const connection = new solanaWeb3.Connection(PUBLIC_RPC, 'confirmed');
          const balanceLamports = await connection.getBalance(publicKey);
          const balanceSol = balanceLamports / solanaWeb3.LAMPORTS_PER_SOL;

          addressEl.textContent = `${pubKeyStr.slice(0,6)}...${pubKeyStr.slice(-4)}`;
          balanceEl.textContent = balanceSol.toFixed(4);
          appEl.style.display = 'block';
          log("✅ Connecté !");
        } catch (err) {
          log(`❌ ${err.message || 'Annulé'}`);
        }
      };
    } else {
      log("❌ Ouvrez cette page dans l'app Phantom → Browser");
    }
  </script>
</body>
</html>
